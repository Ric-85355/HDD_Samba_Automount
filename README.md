# HDD_Samba_Automount
Автоматическое монтирование архивного HDD в слоте и подключение его в Samba
На сервере есть слот для быстрой установки HDD диска (салазки).
Идея в том, чтобы заставить сервер при запуске проверять, если ли HDD в салазках и, если есть, автоматически монтировать его и расшаривать в Samba.
Решение включает в себя несколько составляющих.
### 1. Каталог, куда монтируется
```
   sudo mkdir /mnt/hotswap
   sudo chown -R nobody:nogroup /mnt/hotswap
   sudo chmod 777 /mnt/hotswap
```
### 2. Основной скрипт 
Поместить в `/usr/local/bin/`, используется имя `check-hotswap.sh` (см. файлы)  
Проверить, что в начале скрипта переменная DEVICE указывает на следующий диск в /dev/sdX1

### 3. Добавить `include` в `/etc/samba/smb.conf`
   ```include = /etc/samba/hotswap_auto.conf```  
Подключение динамически формируемой конфигурация при наличии диска (см.далее)

### 4. Проверить наличие ntfs-3g
`sudo apt install ntfs-3g`

### 5. Динамически формируемая конфигурация при наличии диска
Создается просто пустой файл, он заполняется основным скриптом
   ```
   sudo touch /etc/samba/hotswap_auto.conf
   sudo chmod 644 /etc/samba/hotswap_auto.conf
```
### 6. Создание systemd-сервиса
Расположение и имя файла `/etc/systemd/system/hotswap-check.service`
Содержание смотри в файлах.
После создания файла-сервиса перезапускаем systemd демон:
``` sudo systemctl daemon-reload
sudo systemctl enable hotswap-check.service
```
### 7. Проверка опции allow_all
Проверить, что опция `user_allow_other` раскомментирована в `/etc/fuse.conf`   

## Результат работы
Если все сделано правильно - после запуска сервера с вставленным в салазки диском он должен примонтироваться и быть доступным по Samba в ресурсе hotswap

